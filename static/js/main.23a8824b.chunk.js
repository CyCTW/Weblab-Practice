(this["webpackJsonpweblab-practice"]=this["webpackJsonpweblab-practice"]||[]).push([[0],{155:function(e,t,a){e.exports=a(185)},160:function(e,t,a){},185:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(40),o=a.n(c),s=a(3),l=(a(160),a(25)),u=a(13),i=a(8),m=a(24),p=a(190),d=a(116),b=a(192),f=a(200),g=a(17),h=a.n(g),E=a(39),j=a(46),O=a.n(j),w="https://weblab-react-special-midtern.herokuapp.com/",v="users/",S=function(){var e=Object(E.a)(h.a.mark((function e(t){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.a.post("".concat("https://api.weblab.tw/").concat("v1/").concat("auth/general-login"),Object(i.a)(Object(i.a)({},t),{},{appId:"weblab"}));case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=function(){var e=Object(E.a)(h.a.mark((function e(t){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.a.post("".concat("https://api.weblab.tw/").concat("v1/").concat("auth/register"),Object(i.a)(Object(i.a)({},t),{},{appId:"weblab"}));case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),k=function(){var e=Object(E.a)(h.a.mark((function e(){var t,a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={Accept:"application/json","Content-Type":"application/json"},e.next=3,O.a.get("".concat(w).concat("v1/").concat(v),{headers:t});case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),y=function(){var e=Object(E.a)(h.a.mark((function e(t){var a,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={Accept:"application/json","Content-Type":"application/json"},e.next=3,O.a.get("".concat(w).concat("v1/").concat(v).concat(t),{headers:a});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),x=function(){var e=Object(E.a)(h.a.mark((function e(t){var a,n,r,c,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,n=t.userId,r=t.authToken,c={Authorization:"Bearer ".concat(r)},e.next=4,O.a.post("".concat(w).concat("v1/").concat(v).concat(n),a,{headers:c});case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=function(){var e=Object(E.a)(h.a.mark((function e(t){var a,n,r,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.userId,n=t.authToken,console.log(a),console.log(n),r={Authorization:"Bearer ".concat(n)},e.next=6,O.a.delete("\n    ".concat(w).concat("v1/").concat(v).concat(a),{headers:r});case 6:return c=e.sent,e.abrupt("return",c);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=a(64),L=function(e){var t=e.setSelectState,a=e.setIsLogin,c=e.setIsLoginPage,o=e.setAuthToken,l=e.setUserInfo;Object(n.useEffect)((function(){t("login")}),[]);var g=Object(n.useState)({account:null,password:null}),h=Object(s.a)(g,2),E=h[0],j=h[1],O=Object(u.g)(),w=Object(m.useToast)(),v=Object(n.useState)("idle"),I=Object(s.a)(v,2),k=I[0],y=I[1];return r.a.createElement(p.a,{direction:"column",align:"center",height:"60vh"},r.a.createElement(d.a,{id:"username",width:"300px",isRequired:!0},r.a.createElement(b.a,{type:"username",placeholder:"\u4f7f\u7528\u8005\u540d\u7a31",onChange:function(e){j(Object(i.a)(Object(i.a)({},E),{},{account:e.target.value}))}})),r.a.createElement(d.a,{id:"password",width:"300px",mt:5,isRequired:!0},r.a.createElement(b.a,{type:"password",placeholder:"\u5bc6\u78bc",onChange:function(e){j(Object(i.a)(Object(i.a)({},E),{},{password:e.target.value}))}})),r.a.createElement(f.a,{colorScheme:"blue",isLoading:"loading"===k,loadingText:"Submitting",width:"300px",mt:5,disabled:!(E.account&&E.password),onClick:function(){y("loading");S(E).then((function(e){if(console.log(e),null===e.data.result)throw new Error(e.data.message);var t=e.data.result.authToken;o(t);var n=Object(U.a)(t).sub;y("success"),c(!1),a(!0),l({userId:n,username:E.account}),localStorage.setItem("token",JSON.stringify(t)),localStorage.setItem("userInfo",JSON.stringify({userId:n,username:E.account})),O.push("/users/")})).catch((function(e){console.log(e),function(e){w({title:"An error occurred!",description:"".concat(e),status:"error",duration:3e3,isClosable:!0,position:"top"})}(e),y("error")}))}},"\u767b\u5165"))},T=function(e){var t=e.setSelectState,a=e.setIsLogin,c=e.setIsLoginPage,o=e.setAuthToken,l=e.setUserInfo;Object(n.useEffect)((function(){t("signup")}),[]);var g=Object(u.g)(),h=Object(n.useState)({email:null,username:null,password:null}),E=Object(s.a)(h,2),j=E[0],O=E[1],w=Object(n.useState)("idle"),v=Object(s.a)(w,2),S=v[0],k=v[1],y=Object(m.useToast)();return r.a.createElement(r.a.Fragment,null,r.a.createElement(p.a,{direction:"column",align:"center",height:"60vh"},r.a.createElement(d.a,{id:"email",width:"300px",isRequired:!0},r.a.createElement(b.a,{type:"email",placeholder:"\u96fb\u5b50\u4fe1\u7bb1",onChange:function(e){O(Object(i.a)(Object(i.a)({},j),{},{email:e.target.value}))}})),r.a.createElement(d.a,{id:"username",width:"300px",mt:5,isRequired:!0},r.a.createElement(b.a,{type:"username",placeholder:"\u4f7f\u7528\u8005\u540d\u7a31",onChange:function(e){O(Object(i.a)(Object(i.a)({},j),{},{username:e.target.value}))}})),r.a.createElement(d.a,{id:"password",width:"300px",mt:5,isRequired:!0},r.a.createElement(b.a,{type:"password",placeholder:"\u5bc6\u78bc",onChange:function(e){O(Object(i.a)(Object(i.a)({},j),{},{password:e.target.value}))}})),r.a.createElement(f.a,{colorScheme:"blue",isLoading:"loading"===S,loadingText:"Submitting",width:"300px",mt:5,onClick:function(){k("loading");I(j).then((function(e){if(console.log(e),null===e.data.result)throw new Error(e.data.message);var t=e.data.result.authToken,n=Object(U.a)(t).sub;o(t),k("success"),c(!1),a(!0),l({userId:n,username:j.username}),localStorage.setItem("token",JSON.stringify(t)),localStorage.setItem("userInfo",JSON.stringify({userId:n,username:j.username})),g.push("/users/".concat(n,"/edit"))})).catch((function(e){console.log(e),function(e){y({title:"An error occurred!",description:"".concat(e),status:"error",duration:3e3,isClosable:!0,position:"top"})}(e),k("error")}))},disabled:!(j.email&&j.username&&j.password)},"\u52a0\u5165")))},A=a(194),R=a(202),J=a(195),P=a(196),N=a(35),z=a(50),_=a.n(z),B=a(193),q=a(201),D=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(p.a,{direction:"column"},r.a.createElement(B.a,{mt:50},r.a.createElement("h2",{style:{fontFamily:"Monospace"}},"Loading")),r.a.createElement(B.a,{mt:5},r.a.createElement(q.a,{thickness:"4px",speed:"0.65s",emptyColor:"gray.200",color:"blue.500",size:"xl"}))))},F=function(e){var t=e.authToken,a=e.userInfo,c=e.setUserInfo,o=e.setIsLogin,l=Object(u.h)().userId,m=Object(n.useState)("idle"),d=Object(s.a)(m,2),b=d[0],g=d[1],h=Object(n.useState)({username:null,description:null,pictureUrl:null}),E=Object(s.a)(h,2),j=E[0],O=E[1],w=Object(u.g)();Object(n.useEffect)((function(){g("pageLoading"),y(l).then((function(e){var t=e.data.result;O(Object(i.a)(Object(i.a)({},j),{},{username:t.username,description:t.description,pictureUrl:t.picture_url})),c(Object(i.a)(Object(i.a)({},a),{},{pictureUrl:t.picture_url})),console.log(e),g("success")})).catch((function(e){console.log(e),g("error")}))}),[l]);var v=Object(n.useState)(!1),S=Object(s.a)(v,2),I=S[0],k=S[1],x=r.a.useRef(),U=function(){return k(!1)};return"pageLoading"===b?r.a.createElement(D,null):"error"===b?r.a.createElement(A.a,null,"Some error occured! Please try again."):r.a.createElement(p.a,{direction:"column",align:"center"},r.a.createElement(R.a,{src:j.pictureUrl?j.pictureUrl:_.a,w:[150,200,250],p:5}),r.a.createElement(J.a,{mt:5},j.username),r.a.createElement(J.a,{mt:5},j.description),r.a.createElement(p.a,{mt:7,w:[150,200,250],justify:"space-around"},r.a.createElement(f.a,{m:2,onClick:function(){w.push("/users/".concat(l,"/edit"))},disabled:!(a.userId===l)},"\u7de8\u8f2f"),r.a.createElement(f.a,{m:2,colorScheme:"blue",isLoading:"loading"===b,loadingText:"Deleting",onClick:function(){k(!0)},disabled:!(a.userId===l)},"\u522a\u9664\u6b64\u7528\u6236"),r.a.createElement(P.a,{isOpen:I,leastDestructiveRef:x,onClose:U},r.a.createElement(N.f,null,r.a.createElement(P.b,null,r.a.createElement(N.e,{fontSize:"lg",fontWeight:"bold"},"Delete User"),r.a.createElement(N.b,null,"Are you sure? You can't undo this action afterwards. ",r.a.createElement("br",null)," ","Note: After deleting, you'll be auto logout."),r.a.createElement(N.d,null,r.a.createElement(f.a,{ref:x,onClick:U},"Cancel"),r.a.createElement(f.a,{colorScheme:"red",onClick:function(){g("loading"),C({userId:l,authToken:t}).then((function(e){console.log(e),g("success"),o(!1),localStorage.clear(),w.push("/")})).catch((function(e){console.log(e),g("error")}))},ml:3},"Delete")))))))},M=a(197),W=function(e){var t=e.authToken,a=e.userInfo,c=e.setUserInfo,o=Object(u.h)().userId,l=Object(n.useState)("success"),d=Object(s.a)(l,2),g=d[0],j=d[1],O=Object(n.useState)({username:a.username,description:null,pictureUrl:a.pictureUrl}),w=Object(s.a)(O,2),v=w[0],S=w[1],I=Object(n.useState)(!1),k=Object(s.a)(I,2),y=k[0],C=k[1],U=Object(u.g)(),L=Object(m.useToast)(),T=r.a.useRef(null),A=function(){var e=Object(E.a)(h.a.mark((function e(t){var a,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.target.files[0],(n=new FileReader).onload=function(e){S(Object(i.a)(Object(i.a)({},v),{},{pictureUrl:e.target.result}))},n.readAsDataURL(a),j("success");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(p.a,{direction:"column",align:"center"},r.a.createElement(R.a,{src:v.pictureUrl?v.pictureUrl:_.a,w:[150,200,250],p:5}),r.a.createElement(p.a,{w:[150,200,250],justify:"space-between"},r.a.createElement(f.a,{onClick:function(){T.current.click()}},"\u4e0a\u50b3\u982d\u8cbc"),r.a.createElement(b.a,{type:"file",ref:T,onChange:A,style:{display:"none"}}),r.a.createElement(J.a,{ml:3,p:2},"\u4e0a\u9650300KB")),r.a.createElement(b.a,{w:[150,200,250],type:"username",placeholder:"\u4f7f\u7528\u8005\u540d\u7a31",mt:7,onChange:function(e){C(!0),S(Object(i.a)(Object(i.a)({},v),{},{username:e.target.value}))},value:y?null:a.username}),r.a.createElement(M.a,{mt:7,placeholder:"Write an impressive self-introduction here!",w:"60%",h:"200px",onChange:function(e){S(Object(i.a)(Object(i.a)({},v),{},{description:e.target.value}))}}),r.a.createElement(p.a,{mt:7,w:[150,200,250],justify:"space-around"},r.a.createElement(f.a,{onClick:function(){U.push("/users")}},"\u53d6\u6d88"),r.a.createElement(f.a,{ml:5,colorScheme:"blue",isLoading:"loading"===g,loadingText:"Submitting",onClick:function(){j("loading"),x({data:v,userId:o,authToken:t}).then((function(e){if(console.log(e),null===e.data.result){var t=e.data.message;throw new Error(t)}c(Object(i.a)(Object(i.a)({},a),{},{username:v.username,pictureUrl:v.pictureUrl})),j("success"),localStorage.setItem("userInfo",JSON.stringify(Object(i.a)(Object(i.a)({},a),{},{username:v.username,pictureUrl:v.pictureUrl}))),U.push("/users")})).catch((function(e){console.log(e),function(e){L({title:"An error occurred!",description:"".concat(e,". Please try again or choose another Picture!"),status:"error",duration:3e3,isClosable:!0,position:"top"})}(e),j("error")}))},disabled:!v.username},"\u5132\u5b58")))},H=a(198),K=function(e){var t=e.selectState;return r.a.createElement(p.a,{justify:"center",align:"flex-end",height:"40vh"},r.a.createElement(J.a,{m:8},r.a.createElement(B.a,null,r.a.createElement(H.a,{as:l.b,to:"/login",borderBottom:"5px solid transparent",style:"login"===t?{color:"#3182CE",borderColor:"#3182CE"}:{},_hover:{color:"blue.500"}},"\u6703\u54e1\u767b\u5165"))),r.a.createElement(J.a,{m:8},r.a.createElement(B.a,null,r.a.createElement(H.a,{as:l.b,to:"/signup",borderBottom:"5px solid transparent",_hover:{color:"blue.500"},style:"signup"===t?{color:"#3182CE",borderColor:"#3182CE"}:{}},"\u52a0\u5165\u6703\u54e1"))))},Y=function(e){var t=e.isLogin,a=e.setIsLogin,n=e.setIsLoginPage,c=e.userInfo,o=Object(u.g)();return r.a.createElement(p.a,{mb:5,bg:"tomato",w:"100%",p:3,justify:"space-between"},r.a.createElement(H.a,{as:l.b,to:"/users"},"Home"),!0===t?r.a.createElement(p.a,null,r.a.createElement(H.a,{as:l.b,to:"/users/".concat(c.userId),pt:1},c.username),r.a.createElement(f.a,{ml:3,size:"sm",onClick:function(){n(!1),a(!1),localStorage.clear(),o.push("/")}},"\u767b\u51fa")):r.a.createElement(f.a,{size:"sm",onClick:function(){n(!0),o.push("/login")}},"\u767b\u5165"))},G=a(199),Q=function(e){var t=e.user,a=e.setSelectedId;return r.a.createElement(G.b,{key:t.id,ml:5,mt:5,as:"button",onClick:function(){a(t.id)},border:"5px solid orange",boxShadow:"2xl",rounded:"lg",_hover:{boxShadow:"dark-lg"}},r.a.createElement(p.a,{direction:"column",m:2},r.a.createElement(R.a,{src:t.picture_url?t.picture_url:_.a,boxSize:"200px"}),r.a.createElement(B.a,{m:2},t.username)))},V=function(){var e=Object(n.useState)("loading"),t=Object(s.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)([]),l=Object(s.a)(o,2),i=l[0],m=l[1],p=Object(n.useState)(null),d=Object(s.a)(p,2),b=d[0],f=d[1],g=Object(u.g)();return Object(n.useEffect)((function(){c("loading"),k().then((function(e){if(null===e.data.result)throw new Error(e.data.message);console.log(e),m(e.data.result),c("success")})).catch((function(e){console.log(e),c("error")}))}),[]),Object(n.useEffect)((function(){null!==b&&g.push("/users/".concat(b))}),[b]),"loading"===a?r.a.createElement(D,null):"error"===a?r.a.createElement(A.a,null,"Something is wrong..., please try again."):r.a.createElement(G.a,null,i.map((function(e){return r.a.createElement(Q,{key:e.id,user:e,setSelectedId:f})})))};function X(){var e=Object(n.useState)("idle"),t=Object(s.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)(!1),i=Object(s.a)(o,2),m=i[0],p=i[1],d=Object(n.useState)(!1),b=Object(s.a)(d,2),f=b[0],g=b[1],h=Object(n.useState)(null),E=Object(s.a)(h,2),j=E[0],O=E[1],w=Object(n.useState)({userId:null,username:null,pictureUrl:null}),v=Object(s.a)(w,2),S=v[0],I=v[1];return Object(n.useEffect)((function(){var e=localStorage.getItem("token"),t=localStorage.getItem("userInfo");null!==e&&(O(JSON.parse(e)),g(!0),I(JSON.parse(t)))}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement(l.a,null,!0===m?r.a.createElement(K,{selectState:a}):r.a.createElement(Y,{setIsLoginPage:p,isLogin:f,setIsLogin:g,userInfo:S}),r.a.createElement(u.d,null,r.a.createElement(u.b,{key:"0",path:"/",exact:!0},r.a.createElement(u.a,{to:"/users/"})),r.a.createElement(u.b,{key:"1",path:"/login"},r.a.createElement(L,{setSelectState:c,setIsLogin:g,setIsLoginPage:p,setAuthToken:O,setUserInfo:I})),r.a.createElement(u.b,{key:"2",path:"/signup"},r.a.createElement(T,{setSelectState:c,setIsLogin:g,setIsLoginPage:p,setAuthToken:O,setUserInfo:I})),r.a.createElement(u.b,{key:"3",path:"/users/",exact:!0},!0===f&&r.a.createElement(V,null)),r.a.createElement(u.b,{key:"4",path:"/users/:userId",exact:!0},r.a.createElement(F,{authToken:j,userInfo:S,setIsLogin:g,setUserInfo:I})),r.a.createElement(u.b,{key:"5",path:"/users/:userId/edit"},r.a.createElement(W,{authToken:j,userInfo:S,setUserInfo:I})))))}var Z=a(110),$=document.getElementById("root");o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Z.a,null,r.a.createElement(X,null))),$)},50:function(e,t,a){e.exports=a.p+"static/media/user.e7875f01.svg"}},[[155,1,2]]]);
//# sourceMappingURL=main.23a8824b.chunk.js.map